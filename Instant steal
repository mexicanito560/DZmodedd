-- DZ Instant Steal v4 PRO
-- LocalScript -> StarterPlayer > StarterPlayerScripts
-- Funciones: guardar pos, borrar, auto-steal (detecta objetivos "Secret" / "OG"), chilli hover, DZ Instant Steal (teleports secuenciales y se detiene al final), speed boost = 26
-- Hecho por ChatGPT para Damiancito üòé

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
if not LocalPlayer then return end

-- ====== CONFIG ======
local MAX_POS = 5
local TELEPORT_DELAY = 0.8    -- tiempo entre teleports (seg)
local HOVER_TIME = 1          -- tiempo de hover en cada teleport (seg)
local CHILLI_HOVER_HEIGHT = 1.6 -- amplitude of gentle hover while active
local SPEED_NORMAL = 16
local SPEED_BOOST = 26
local AUTO_STEAL_RANGE = 120 -- studs para detectar objetivo cercano

-- ====== ESTADO ======
local SavedPositions = {}              -- array de Vector3
local Teleporting = false
local ToggleOn = false
local CurrentIndex = 1

local AutoStealEnabled = false
local ChilliHoverEnabled = false

-- UI references
local gui, frame, btnToggle, btnSave, btnClear, btnAuto, btnChilli, infoLabel

-- ====== HELPERS ======
local function safeFindPlayerCharacter(player)
    if not player then return nil end
    return player.Character or player.CharacterAdded:Wait()
end

local function getHRP()
    local char = LocalPlayer.Character
    if not char then return nil end
    return char:FindFirstChild("HumanoidRootPart")
end

local function setWalkSpeed(speed)
    local char = LocalPlayer.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if hum then
        pcall(function() hum.WalkSpeed = speed end)
    end
end

-- smooth hover (chilli): gently keep player lifted for HOVER_TIME (client-side)
local function chilliHover(hrp, duration)
    if not hrp then return end
    local t0 = tick()
    local baseY = hrp.Position.Y
    local conn
    conn = RunService.RenderStepped:Connect(function()
        if not hrp or not hrp.Parent then conn:Disconnect() return end
        local elapsed = tick() - t0
        if elapsed >= duration then conn:Disconnect() return end
        local phase = math.sin(elapsed * 3.5) * (CHILLI_HOVER_HEIGHT * 0.2) -- small bob
        -- gently lerp Y toward baseY + small offset
        local targetY = baseY + 0.6 + phase
        local current = hrp.Position
        local newY = current.Y + (targetY - current.Y) * 0.35
        -- set CFrame keeping X/Z
        local cf = CFrame.new(current.X, newY, current.Z, hrp.CFrame:ToOrientation())
        pcall(function() hrp.CFrame = cf end)
    end)
end

-- simple hover (hard stop of vertical velocity) for HOVER_TIME
local function simpleHover(hrp, duration)
    if not hrp then return end
    local t0 = tick()
    local conn
    conn = RunService.RenderStepped:Connect(function()
        if not hrp or not hrp.Parent then conn:Disconnect() return end
        local v = hrp.AssemblyLinearVelocity
        pcall(function() hrp.AssemblyLinearVelocity = Vector3.new(v.X, 0, v.Z) end)
        if tick() - t0 >= duration then conn:Disconnect() return end
    end)
end

-- decide hover type
local function doHover(hrp)
    if ChilliHoverEnabled then
        chilliHover(hrp, HOVER_TIME)
    else
        simpleHover(hrp, HOVER_TIME)
    end
end

-- ====== AUTO STEAL: detectar target cercano "Secret" o "OG" (b√°sico) ======
-- Esta detecci√≥n es heur√≠stica: busca modelos/parts en workspace cuyo Name contenga "Secret" o "OG" o "Brainrot"
-- y que est√©n a menos de AUTO_STEAL_RANGE studs de tu c√°mara.
local function findNearestTarget()
    local camPos = Workspace.CurrentCamera and Workspace.CurrentCamera.CFrame.Position or (getHRP() and getHRP().Position)
    if not camPos then return nil end

    local best, bestDist = nil, math.huge
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") or obj:IsA("Model") then
            local name = obj.Name:lower()
            if name:find("secret") or name:find("og") or name:find("brainrot") or name:find("brair") then
                local pos
                if obj:IsA("BasePart") then
                    pos = obj.Position
                else
                    local hrp = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChildWhichIsA("BasePart")
                    if hrp then pos = hrp.Position end
                end
                if pos then
                    local d = (pos - camPos).Magnitude
                    if d < bestDist and d <= AUTO_STEAL_RANGE then
                        bestDist = d
                        best = pos
                    end
                end
            end
        end
    end
    return best
end

-- ====== TELEPORT LOOP (secuencial, se detiene al llegar a la √∫ltima) ======
local function teleportLoop()
    while Teleporting and CurrentIndex <= #SavedPositions do
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        local pos = SavedPositions[CurrentIndex]
        if pos then
            -- subimos ligeramente para evitar colisiones
            local target = pos + Vector3.new(0, 3, 0)
            pcall(function() hrp.CFrame = CFrame.new(target) end)
            doHover(hrp)
        end

        -- espera con posibilidad de cancel
        local elapsed = 0
        while elapsed < TELEPORT_DELAY do
            if not Teleporting then break end
            task.wait(0.05)
            elapsed = elapsed + 0.05
        end

        CurrentIndex = CurrentIndex + 1
    end

    -- se detiene al llegar al final o al cancelar
    Teleporting = false
    ToggleOn = false
    setWalkSpeed(SPEED_NORMAL)
    if btnToggle and btnToggle.Parent then
        btnToggle.BackgroundColor3 = Color3.fromRGB(58,58,58)
        btnToggle.Text = "Start"
    end
    updateInfo() -- actualiza info visual
end

-- ====== UI CREATION ======
local function clampToScreen(inst)
    -- ensure GUI stays visible (small clamp)
    local cam = Workspace.CurrentCamera
    if not cam then return end
    local view = cam.ViewportSize
    local pos = inst.AbsolutePosition
    local size = inst.AbsoluteSize
    local newX = math.clamp(pos.X, 6, view.X - size.X - 6)
    local newY = math.clamp(pos.Y, 6, view.Y - size.Y - 6)
    inst.Position = UDim2.new(0, newX, 0, newY)
end

local function createUI()
    local playerGui = LocalPlayer:FindFirstChild("PlayerGui") or LocalPlayer:WaitForChild("PlayerGui")
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "DZInstantStealUI_v4"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui
    screenGui.IgnoreGuiInset = true
    screenGui.DisplayOrder = 9999

    local f = Instance.new("Frame", screenGui)
    f.Name = "Main"
    f.Size = UDim2.new(0, 300, 0, 170)
    f.Position = UDim2.new(0.5, -150, 0.18, 0)
    f.BackgroundColor3 = Color3.fromRGB(20,20,20)
    f.BorderSizePixel = 0
    f.Active = true
    f.Draggable = true
    local fc = Instance.new("UICorner", f); fc.CornerRadius = UDim.new(0,12)

    local title = Instance.new("TextLabel", f)
    title.Size = UDim2.new(1, -24, 0, 32)
    title.Position = UDim2.new(0, 12, 0, 8)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.TextColor3 = Color3.new(1,1,1)
    title.Text = "üí† DZ Instant Steal v4 PRO"

    -- info label
    infoLabel = Instance.new("TextLabel", f)
    infoLabel.Size = UDim2.new(1, -24, 0, 18)
    infoLabel.Position = UDim2.new(0, 12, 0, 38)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.TextSize = 13
    infoLabel.TextColor3 = Color3.fromRGB(200,200,200)
    infoLabel.Text = "Posiciones: 0 / 5 | AutoSteal: OFF | Chilli: OFF"

    -- DZ Toggle (start/stop)
    btnToggle = Instance.new("TextButton", f)
    btnToggle.Size = UDim2.new(0.45, -8, 0, 36)
    btnToggle.Position = UDim2.new(0.05, 0, 0, 64)
    btnToggle.BackgroundColor3 = Color3.fromRGB(58,58,58)
    btnToggle.Font = Enum.Font.GothamBold
    btnToggle.TextSize = 14
    btnToggle.TextColor3 = Color3.new(1,1,1)
    btnToggle.Text = "Start"
    local btc = Instance.new("UICorner", btnToggle); btc.CornerRadius = UDim.new(0,10)

    -- Save button
    btnSave = Instance.new("TextButton", f)
    btnSave.Size = UDim2.new(0.45, -8, 0, 36)
    btnSave.Position = UDim2.new(0.5, 8, 0, 64)
    btnSave.BackgroundColor3 = Color3.fromRGB(68,68,68)
    btnSave.Font = Enum.Font.Gotham
    btnSave.TextSize = 13
    btnSave.TextColor3 = Color3.new(1,1,1)
    btnSave.Text = "üíæ Guardar posici√≥n (0/5)"
    local bsc = Instance.new("UICorner", btnSave); bsc.CornerRadius = UDim.new(0,10)

    -- Clear positions
    btnClear = Instance.new("TextButton", f)
    btnClear.Size = UDim2.new(0.45, -8, 0, 28)
    btnClear.Position = UDim2.new(0.05, 0, 0, 112)
    btnClear.BackgroundColor3 = Color3.fromRGB(88,36,36)
    btnClear.Font = Enum.Font.Gotham
    btnClear.TextSize = 13
    btnClear.TextColor3 = Color3.new(1,1,1)
    btnClear.Text = "üóëÔ∏è Borrar posiciones"
    local bcc = Instance.new("UICorner", btnClear); bcc.CornerRadius = UDim.new(0,8)

    -- AutoSteal toggle
    btnAuto = Instance.new("TextButton", f)
    btnAuto.Size = UDim2.new(0.45, -8, 0, 28)
    btnAuto.Position = UDim2.new(0.5, 8, 0, 112)
    btnAuto.BackgroundColor3 = Color3.fromRGB(68,68,68)
    btnAuto.Font = Enum.Font.Gotham
    btnAuto.TextSize = 13
    btnAuto.TextColor3 = Color3.new(1,1,1)
    btnAuto.Text = "‚ö° Auto Steal: OFF"
    local bac = Instance.new("UICorner", btnAuto); bac.CornerRadius = UDim.new(0,8)

    -- Chilli Hover toggle (small)
    btnChilli = Instance.new("TextButton", f)
    btnChilli.Size = UDim2.new(0.88, 0, 0, 22)
    btnChilli.Position = UDim2.new(0.06, 0, 0, 144)
    btnChilli.BackgroundColor3 = Color3.fromRGB(48,48,48)
    btnChilli.Font = Enum.Font.Gotham
    btnChilli.TextSize = 12
    btnChilli.TextColor3 = Color3.new(1,1,1)
    btnChilli.Text = "üå™Ô∏è Chilli Hover: OFF"
    local chc = Instance.new("UICorner", btnChilli); chc.CornerRadius = UDim.new(0,8)

    -- small decorative rainbow stroke for title area
    local stroke = Instance.new("UIStroke", f)
    stroke.Thickness = 2
    RunService.Heartbeat:Connect(function()
        stroke.Color = Color3.fromHSV((tick()*0.45)%1, 1, 1)
    end)

    return {
        gui = screenGui,
        frame = f,
        btnToggle = btnToggle,
        btnSave = btnSave,
        btnClear = btnClear,
        btnAuto = btnAuto,
        btnChilli = btnChilli,
        infoLabel = infoLabel,
    }
end

-- updates info label text
function updateInfo()
    local total = #SavedPositions
    local autoTxt = AutoStealEnabled and "ON" or "OFF"
    local chilliTxt = ChilliHoverEnabled and "ON" or "OFF"
    if infoLabel and infoLabel.Parent then
        infoLabel.Text = ("Posiciones: %d / %d | AutoSteal: %s | Chilli: %s"):format(total, MAX_POS, autoTxt, chilliTxt)
    end
    if btnSave and btnSave.Parent then
        btnSave.Text = ("üíæ Guardar posici√≥n (%d/%d)"):format(total, MAX_POS)
    end
    if btnAuto and btnAuto.Parent then
        btnAuto.Text = AutoStealEnabled and "‚ö° Auto Steal: ON" or "‚ö° Auto Steal: OFF"
        btnAuto.BackgroundColor3 = AutoStealEnabled and Color3.fromRGB(0,160,90) or Color3.fromRGB(68,68,68)
    end
    if btnChilli and btnChilli.Parent then
        btnChilli.Text = ChilliHoverEnabled and "üå™Ô∏è Chilli Hover: ON" or "üå™Ô∏è Chilli Hover: OFF"
        btnChilli.BackgroundColor3 = ChilliHoverEnabled and Color3.fromRGB(0,140,220) or Color3.fromRGB(48,48,48)
    end
end

-- ====== EVENTOS UI & L√ìGICA ======
local ui = createUI()
gui = ui.gui; frame = ui.frame; btnToggle = ui.btnToggle; btnSave = ui.btnSave; btnClear = ui.btnClear; btnAuto = ui.btnAuto; btnChilli = ui.btnChilli; infoLabel = ui.infoLabel
updateInfo()

-- Save pos
btnSave.MouseButton1Click:Connect(function()
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    if #SavedPositions < MAX_POS then
        table.insert(SavedPositions, hrp.Position)
        updateInfo()
        print(("[DZ] Guardada pos #%d (%.2f, %.2f, %.2f)"):format(#SavedPositions, hrp.Position.X, hrp.Position.Y, hrp.Position.Z))
    else
        -- feedback
        btnSave.Text = "‚ö†Ô∏è L√≠mite 5 alcanzado"
        task.delay(1.2, function() if btnSave and btnSave.Parent then updateInfo() end end)
    end
end)

-- Clear pos
btnClear.MouseButton1Click:Connect(function()
    SavedPositions = {}
    updateInfo()
    print("[DZ] Posiciones borradas")
end)

-- AutoSteal toggle
btnAuto.MouseButton1Click:Connect(function()
    AutoStealEnabled = not AutoStealEnabled
    updateInfo()
end)

-- Chilli hover toggle
btnChilli.MouseButton1Click:Connect(function()
    ChilliHoverEnabled = not ChilliHoverEnabled
    updateInfo()
end)

-- Toggle main (start/stop): se detiene autom√°ticamente al llegar a la √∫ltima
btnToggle.MouseButton1Click:Connect(function()
    ToggleOn = not ToggleOn
    if ToggleOn then
        if #SavedPositions == 0 then
            -- no hay posiciones
            StarterGui:SetCore("SendNotification", {Title="DZ Instant Steal", Text="Guarda posiciones primero", Duration=1.6})
            ToggleOn = false
            return
        end
        -- visual ON
        btnToggle.BackgroundColor3 = Color3.fromRGB(0,160,90)
        btnToggle.Text = "Stop"
        setWalkSpeed(SPEED_BOOST)
        Teleporting = true
        CurrentIndex = 1
        task.spawn(teleportLoop)
    else
        -- stop
        Teleporting = false
        setWalkSpeed(SPEED_NORMAL)
        btnToggle.BackgroundColor3 = Color3.fromRGB(58,58,58)
        btnToggle.Text = "Start"
    end
    updateInfo()
end)

-- ====== AUTO-STEAL BACKGROUND CHECK ======
-- Si AutoStealEnabled, detecta objetivos y auto-empieza el ciclo:
task.spawn(function()
    while true do
        task.wait(0.6)
        if AutoStealEnabled and not Teleporting then
            local targetPos = findNearestTarget()
            if targetPos then
                -- si hay target cercano, intenta guardar la pos actual al inicio (si hay espacio), y a√±ade target pos como √∫ltima
                pcall(function()
                    local hrp = getHRP()
                    if hrp and #SavedPositions > 0 then
                        -- if we already have saved route, start teleporting from saved route
                        -- pero si no hay guardadas, guardamos current y target
                    end
                    -- Option: append the target as a final pos (but don't exceed MAX_POS)
                    if #SavedPositions == 0 then
                        -- guarda tu pos como punto 1
                        local cur = hrp and hrp.Position
                        if cur then
                            SavedPositions[#SavedPositions+1] = cur
                        end
                    end
                    -- add the target pos as subsequent point if space
                    if #SavedPositions < MAX_POS then
                        SavedPositions[#SavedPositions+1] = targetPos
                    end
                end)
                -- start cycle automatically (se detendr√° al final)
                if #SavedPositions > 0 then
                    ToggleOn = true
                    Teleporting = true
                    btnToggle.BackgroundColor3 = Color3.fromRGB(0,160,90)
                    btnToggle.Text = "Stop"
                    setWalkSpeed(SPEED_BOOST)
                    CurrentIndex = 1
                    task.spawn(teleportLoop)
                end
            end
        end
    end
end)

-- ====== UI safety / clamp on screen jede render ======
RunService.RenderStepped:Connect(function()
    pcall(function()
        if frame and frame.Parent then clampToScreen(frame) end
    end)
end)

-- ensure normal speed on respawn
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.8)
    setWalkSpeed(SPEED_NORMAL)
    -- don't auto-clear positions
    -- hide UI is not desired; keep visible
    updateInfo()
end)

-- final message
print("[DZ Instant Steal v4 PRO] cargado correctamente. Usa la UI para guardar posiciones y activar el ciclo.")
StarterGui:SetCore("SendNotification", {Title="DZ Instant Steal", Text="UI lista (mira el men√∫)", Duration=2})
